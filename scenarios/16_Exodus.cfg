#textdomain wesnoth-Flight_Freedom

[scenario]
    name= _ "The Exodus"
    {MAP 16}
    {TURNS 50 41 32}
    {SCENARIO_MUSIC battle.ogg}
#ifdef HAVE_UMC08_MUSIC
    {EXTRA_SCENARIO_MUSIC Epic_Race.ogg}
#endif
    id=Exodus
    next_scenario="Blockade"
    victory_when_enemies_defeated=no

    {AFTERNOON}
    {DUSK}
    {FIRST_WATCH}
    {SECOND_WATCH}
    {DAWN}
    {MORNING}

    {STORY_EXODUS}

    [side]
        type=Drake Chieftain
        id=Malakar
        name= _ "Malakar"
        side=1
        {FLAG_VARIANT drake}
        canrecruit=yes
        controller=human
        recruit=Drake Hatchling,Drake Slave,Drake Burner,Drake Glider,Drake Fighter,Drake Clasher
        unrenamable=yes
        team_name=good
        user_team_name= _ "Kakatar Tribe"
        fog=no
        {GOLD 190 145 100}
        {INCOME 5 3 1}
    [/side]
    [side]
        type=Highwayman
        id=Rhygwyn
        name= _ "Rhygwyn"
        side=2
        controller=ai
        canrecruit=yes
        {GOLD 300 400 500}
        recruit=Thug,Thief,Poacher,Footpad,Rogue,Trapper,Walking Corpse
        team_name=evil
        user_team_name= _ "Wesnoth Army Deserters"
#ifdef EASY
        [ai]
            simple_targeting=yes
        [/ai]
#endif
    [/side]
    {LIMIT_RECRUITS 2 Skeleton 1}
    [side]
        type=Fugitive
        id=Rhaedoc
        name= _ "Rhaedoc"
        side=3
        controller=ai
        canrecruit=yes
        {GOLD 300 400 500}
        recruit=Thief,Poacher,Footpad,Outlaw,Rogue,Trapper,Walking Corpse
        team_name=evil
        user_team_name= _ "Wesnoth Army Deserters"
#ifdef EASY
        [ai]
            simple_targeting=yes
        [/ai]
#endif
    [/side]
    {LIMIT_RECRUITS 3 Skeleton 1}
    [side]
        type=Highwayman
        id=Labryn
        name= _ "Labryn"
        side=4
        controller=ai
        canrecruit=yes
        {GOLD 300 400 500}
        recruit=Thug,Thief,Poacher,Footpad,Trapper,Bandit,Walking Corpse
        team_name=evil
        user_team_name= _ "Wesnoth Army Deserters"
#ifdef EASY
        [ai]
            simple_targeting=yes
        [/ai]
#endif
    [/side]
    {LIMIT_RECRUITS 4 Skeleton 1}

    [event]
        name=prestart
        [if]
            [variable]
                name=gave_up_kogw
                boolean_equals=no
            [/variable]
            [then]
                [recall]
                    id=Kogw
                [/recall]
            [/then]
            [else]
                [recall]
                    id=Theracar
                [/recall]
            [/else]
        [/if]
        #just in case she somehow survived the last scenario
        [kill]
            id=Elealonna
            fire_event=no
        [/kill]
    [/event]

    [event]
        name=start
        [if]
            [variable]
                name=gave_up_kogw
                boolean_equals=no
            [/variable]
            [then]
                [message]
                    speaker=narrator
                    message= _ "A mere four days of travel later, the tribe found themselves on familiar ground -- and Kogw found himself among familiar faces."
                    image="misc/icon-drake.png"
                [/message]
                #NOADV version used because it wouldn't make sense to have more than one captain
                [move_unit_fake]
                    x=32,37
                    y=46,46
                    type=Pirate NOADV
                    side=1
                [/move_unit_fake]
                [unit]
                    type=Pirate NOADV
                    side=1
                    gender=male
                    x,y=37,46
                    id=Rhys
                    name= _ "Rhys"
                    unrenamable=yes
                    random_traits=no
                    facing=se
                    [modifications]
                        {TRAIT_LOYAL_HERO}
                        {TRAIT_STRONG}
                        {TRAIT_RESILIENT}
                    [/modifications]
                [/unit]
                [redraw]
                [/redraw]
                [lock_view]
                [/lock_view]
                [move_unit_fake]
                    x=32,38
                    y=46,47
                    type=Pirate NOADV
                    side=1
                [/move_unit_fake]
                [unit]
                    type=Pirate NOADV
                    side=1
                    gender=male
                    x,y=38,47
                    id=Davies
                    name= _ "Davies"
                    unrenamable=yes
                    random_traits=no
                    facing=n
                    [modifications]
                        {TRAIT_LOYAL_HERO}
                        {TRAIT_FEARLESS}
                        {TRAIT_RESILIENT}
                    [/modifications]
                [/unit]
                [redraw]
                [/redraw]
                [unlock_view]
                [/unlock_view]
                [message]
                    speaker=Rhys
                    message= _ "Captain Kogw! Captain Kogw!"
                [/message]
                [message]
                    speaker=Kogw
                    message= _ "Rhys?"
                [/message]
                [message]
                    speaker=Kogw
                    message= _ "You old scoundrel! How in blazes are you still alive?"
                [/message]
                [message]
                    speaker=Rhys
                    message= _ "You think a few measly warships could really stop the Unforgiver? We played 'possum until they were fully docked, then high-tailed it back North."
                [/message]
                [message]
                    speaker=Kogw
                    message= _ "North? Wouldn't a, y'know, daring rescue been more appropriate?"
                [/message]
                [message]
                    speaker=Rhys
                    message= _ "Well, that's what I said, but Davies, here..."
                [/message]
                [message]
                    speaker=Davies
                    message= _ "Leave me out of this, bilge-rat."
                [/message]
                [message]
                    speaker=Rhys
                    message= _ "Anyways, the wind blew us back and we've been circling the island since, trying to resupply without getting attacked."
                [/message]
                [message]
                    speaker=Kogw
                    message= _ "The Unforgiver is still in one piece? That's wonderful! We'll have ocean's finest ride all the way to Morogor!"
                [/message]
                [message]
                    speaker=Rhys
                    message= _ "Yep, it's just off-shore to the northwest."
                [/message]
                [unstore_unit]
                    variable=unforgiver_store
                    x,y=2,1
                [/unstore_unit]
                [scroll_to]
                    x,y=2,1
                    highlight=yes
                [/scroll_to]
                [redraw][/redraw]
                [lock_view][/lock_view]
                [delay]
                    time=234
                [/delay]
                [unlock_view][/unlock_view]
                [redraw][/redraw]
                [message]
                    speaker=Davies
                    message= _ "Surprising number of unfriendly-types around here. Real strange chaps too for army deserters; something's not right on this island."
                [/message]
                [message]
                    speaker=Kogw
                    message= _ "If it's supplies you need..."
                [/message]
                [message]
                    speaker=Malakar
                    message= _ "Drakes! Clear the area of interference immediately. We are leaving these cursed shores!"
                [/message]
                [message]
                    speaker=Rhys
                    message= _ "Speaking of which, I think I saw a skeleton last week. Craziest thing..."
                [/message]
                [message]
                    speaker=Davies
                    message= _ "Oh, and we've scraped together a few coins. We kind of figured we'd be using them to buy our way out of here, but as long as you're alive I suppose they're yours."
                [/message]
                [gold]
                    side=1
                    amount={ON_DIFFICULTY 90 60 30}
                [/gold]
                [sound]
                    name=gold.ogg
                [/sound]

                [message]
                    speaker=Rhys
                    message= _ "Also, the village we were staying in is friendly."
                [/message]
                [capture_village]
                    side=1
                    x,y=32,46
                [/capture_village]
                {VARIABLE pirates_captured yes}
                {OBJECTIVES_HEADER}
                    {CONDITION_WIN ( _ "Defeat all enemy leaders")}
                    {CONDITION_LOSE ( _ "Death of Rhys")}
                    {CONDITION_LOSE ( _ "Death of Davies")}
                    {CONDITION_LOSE ( _ "Destruction of the Unforgiver")}
                    {OBJECTIVES_LOSE}
                    {GOLD_CARRYOVER_STANDARD}
                {OBJECTIVES_FOOTER}
            [/then]
            [else]
                [message]
                    speaker=narrator
                    message= _ "A mere four days of travel later, the tribe found themselves on familiar ground."
                    image="misc/icon-drake.png"
                [/message]
                #NOADV version used because it wouldn't make sense to have more than one captain
                [move_unit_fake]
                    x=32,33
                    y=46,46
                    type=Pirate NOADV
                    side=2
                [/move_unit_fake]
                [unit]
                    type=Pirate NOADV
                    side=2
                    gender=male
                    x,y=33,46
                    id=Rhys
                    name= _ "Rhys"
                    unrenamable=yes
                    random_traits=no
                    facing=se
                    [modifications]
                        {TRAIT_STRONG}
                        {TRAIT_RESILIENT}
                    [/modifications]
                [/unit]
                [redraw]
                [/redraw]
                [lock_view]
                [/lock_view]
                [move_unit_fake]
                    x=32,33
                    y=46,47
                    type=Pirate NOADV
                    side=2
                [/move_unit_fake]
                [unit]
                    type=Pirate NOADV
                    side=2
                    gender=male
                    x,y=33,47
                    id=Davies
                    name= _ "Davies"
                    unrenamable=yes
                    random_traits=no
                    facing=ne
                    [modifications]
                        {TRAIT_FEARLESS}
                        {TRAIT_RESILIENT}
                    [/modifications]
                [/unit]
                [redraw]
                [/redraw]
                [unlock_view]
                [/unlock_view]
                [message]
                    speaker=Rhys
                    message= _ "Drakes! Do you bring word of Kogw?"
                [/message]
                [message]
                    speaker=Theracar
                    image=$theracar_image
                    message= _ "Thinskin. Which way to Morogor?"
                [/message]
                [message]
                    speaker=Davies
                    message= _ "Rhys, here, says that he's got a map. But first, tell us of our captain!"
                [/message]
                [message]
                    speaker=Malakar
                    message= _ "The captain is dead. He was killed by the elves."
                [/message]
                [unit]
                    x=32
                    y=46
                    id=s16_peasant
                    type=Peasant Woman
                    gender=female
                    side=2
                    facing=ne
                    generate_name=yes
                [/unit]
                [message]
                    speaker=s16_peasant
                    message= _ "We all heard how the elves killed a pirate in the forest! Oh dearie... 'twas so horrible... I swear we could hear his screams for days..."
                [/message]
                [message]
                    speaker=Rhys
                    message= _ "And you drakes let him die!"
                [/message]
                [message]
                    speaker=Theracar
                    image=$theracar_image
                    message= _ "Hand over the map now, thinskin, or you shall join your captain. Believe me, you would suffer far more burning alive by my flame than anything the pointy ears could do."
                [/message]
                [message]
                    speaker=Davies
                    message= _ "Rhys, let's go. We've scraped together a few coins, we can buy a way out of here with the deserters."
                [/message]
                [kill]
                    id=Rhys
                    animate=no
                    fire_event=no
                [/kill]
                [move_unit_fake]
                    x=33,32
                    y=46,46
                    type=Pirate NOADV
                    side=2
                [/move_unit_fake]
                [kill]
                    id=Davies
                    animate=no
                    fire_event=no
                [/kill]
                [move_unit_fake]
                    x=33,32
                    y=47,46
                    type=Pirate NOADV
                    side=2
                [/move_unit_fake]
                [kill]
                    id=s16_peasant
                    animate=no
                    fire_event=no
                [/kill]
                [capture_village]
                    x,y=32,46
                [/capture_village]
                {VARIABLE pirate_x 32}
                {VARIABLE pirate_y 46}
                {VARIABLE pirates_captured no}
                {OBJECTIVES_HEADER}
                    {CONDITION_WIN ( _ "Capture the pirates")}
                    {CONDITION_WIN ( _ "Defeat all enemy leaders")}
                    {OBJECTIVES_LOSE}
                    {GOLD_CARRYOVER_STANDARD}
                {OBJECTIVES_FOOTER}
            [/else]
        [/if]

        {VARIABLE unforgiver_kill_count 0}
    [/event]

    [event]
        name=capture
        first_time_only=no
        [if]
            [variable]
                name=pirates_captured
                boolean_equals=no
            [/variable]
            [then]
                [if]
                    [variable]
                        name=pirate_x
                        equals=$x1
                    [/variable]
                    [and]
                        [variable]
                            name=pirate_y
                            equals=$y1
                        [/variable]
                    [/and]
                    [then]
                        #find nearest two land villages (based off of nearest_hex in https://github.com/Elvish-Hunter/Wesnoth_Lua_Pack/blob/master/wml-tags.lua)
                        #if either not captured, move pirates there (preferentially closer village)
                        #if both are captured, pirates have nowhere to go; whoever captured this village gets them
                        {VARIABLE pirates_move no}
                        [lua]
                            code = <<
                                local pirate_x = tonumber(wml.variables["pirate_x"])
                                local pirate_y = tonumber(wml.variables["pirate_y"])
                                local village_distances = {}
                                for index,location in ipairs(wesnoth.map.find({terrain="*^Ve,*^Vh,*^Vct"})) do
                                    local distance = wesnoth.map.distance_between(pirate_x, pirate_y, location)
                                    table.insert(village_distances,{distance,location})
                                end
                                table.sort(village_distances, function(k1, k2) return k1[1] < k2[1] end)
                                for i=3,2,-1 do
                                    local village_x = village_distances[i][2]["x"]
                                    local village_y = village_distances[i][2]["y"]
                                    if wesnoth.map.get_owner(village_x, village_y) == nil then
                                        wml.variables["pirate_x"] = village_x
                                        wml.variables["pirate_y"] = village_y
                                        wml.variables["pirates_move"] = "yes"
                                    end
                                end
                            >>
                        [/lua]
                        [if]
                            [variable]
                                name=pirates_move
                                boolean_equals=yes
                            [/variable]
                            [then]
                                [move_unit_fake]
                                    x=$x1,$pirate_x
                                    y=$y1,$pirate_y
                                    type=Pirate NOADV
                                    side=2
                                [/move_unit_fake]
                                [lock_view]
                                [/lock_view]
                                [scroll_to]
                                    x=$pirate_x
                                    y=$pirate_y
                                [/scroll_to]
                                [unlock_view]
                                [/unlock_view]
                            [/then]
                            [else]
                                [unit]
                                    type=Pirate NOADV
                                    side=2
                                    gender=male
                                    x,y=$x1,$y1
                                    id=Rhys
                                    name= _ "Rhys"
                                    unrenamable=yes
                                    random_traits=no
                                    [modifications]
                                        {TRAIT_STRONG}
                                        {TRAIT_RESILIENT}
                                    [/modifications]
                                [/unit]
                                [unit]
                                    type=Pirate NOADV
                                    side=2
                                    gender=male
                                    x,y=$x1,$y1
                                    id=Davies
                                    name= _ "Davies"
                                    unrenamable=yes
                                    random_traits=no
                                    facing=ne
                                    [modifications]
                                        {TRAIT_FEARLESS}
                                        {TRAIT_RESILIENT}
                                    [/modifications]
                                [/unit]
                                [if]
                                    [variable]
                                        name=side_number
                                        numerical_equals=1
                                    [/variable]
                                    [then]
                                        {VARIABLE pirates_captured yes}
                                        [if]
                                            [not]
                                                [have_unit]
                                                    id=Malakar
                                                    x,y=$x1,$y1
                                                [/have_unit]
                                            [/not]
                                            [then]
                                                [message]
                                                    speaker=unit
                                                    message= _ "Chief, we have found the pirates!"
                                                [/message]
                                            [/then]
                                        [/if]
                                        [message]
                                            speaker=Malakar
                                            message= _ "The map. Hand it over. NOW!"
                                        [/message]
                                        [message]
                                            speaker=Rhys
                                            message= _ "You betrayed my captain! I'll rip it to shreds it before I ever give it to you monsters!"
                                        [/message]
                                        [if]
                                            [not]
                                                [have_unit]
                                                    id=Malakar,Theracar
                                                    x,y=$x1,$y1
                                                [/have_unit]
                                            [/not]
                                            [then]
                                                [if]
                                                    [variable]
                                                        name=unit.race
                                                        equals="drake"
                                                    [/variable]
                                                    [then]
                                                        [message]
                                                            speaker=Theracar
                                                            image=$theracar_image
                                                            message= _ "Drake, kill his companion."
                                                        [/message]
                                                    [/then]
                                                    [else]
                                                        [message]
                                                            speaker=Theracar
                                                            image=$theracar_image
                                                            message= _ "Kill his companion."
                                                        [/message]
                                                    [/else]
                                                [/if]
                                            [/then]
                                        [/if]
                                        [store_unit]
                                            [filter]
                                                id=Rhys
                                            [/filter]
                                            variable=rhys_store
                                        [/store_unit]
                                        [store_unit]
                                            [filter]
                                                id=Davies
                                            [/filter]
                                            variable=davies_store
                                        [/store_unit]
                                        [animate_unit]
                                            [filter]
                                                x,y=$x1,$y1
                                            [/filter]
                                            flag=attack
                                            [primary_attack]
                                                range=melee
                                            [/primary_attack]
                                            hits=kill
                                            [facing]
                                                x=$davies_store.x
                                                y=$davies_store.y
                                            [/facing]
                                        [/animate_unit]
                                        [kill]
                                            id=Davies
                                            animate=yes
                                            fire_event=no
                                            [secondary_unit]
                                                x,y=$x1,$y1
                                            [/secondary_unit]
                                            [primary_attack]
                                                range=melee
                                            [/primary_attack]
                                        [/kill]
                                        [delay]
                                            time=1000
                                            accelerate=yes
                                        [/delay]
                                        [message]
                                            speaker=Theracar
                                            image=$theracar_image
                                            message= _ "Listen to me well, thinskin. You have nowhere left to run. You will not leave here alive. Give us the map and your death will be swift. Otherwise it will be... slow."
                                            sound=fire.wav
                                        [/message]
                                        [message]
                                            speaker=Rhys
                                            message= _ "I... I... h-h-here you go... t-t-take the map... please don't kill me... please don't kill me!"
                                        [/message]
                                        [message]
                                            speaker=Theracar
                                            image=$theracar_image
                                            message= _ "Very well. Now stand and face your end!"
                                        [/message]
                                        [animate_unit]
                                            [filter]
                                                x,y=$x1,$y1
                                            [/filter]
                                            flag=attack
                                            [primary_attack]
                                                range=melee
                                            [/primary_attack]
                                            hits=kill
                                            [facing]
                                                x=$rhys_store.x
                                                y=$rhys_store.y
                                            [/facing]
                                        [/animate_unit]
                                        [kill]
                                            id=Rhys
                                            animate=yes
                                            fire_event=no
                                            [secondary_unit]
                                                x,y=$x1,$y1
                                            [/secondary_unit]
                                            [primary_attack]
                                                range=melee
                                            [/primary_attack]
                                        [/kill]
                                        {CLEAR_VARIABLE rhys_store}
                                        {CLEAR_VARIABLE davies_store}
                                        [if]
                                            [have_unit]
                                                side=2,3,4
                                                canrecruit=yes
                                            [/have_unit]
                                            [then]
                                                [message]
                                                    speaker=Malakar
                                                    message= _ "This map points the way to Morogor! Now we must drive away these stragglers so we can prepare to depart this cursed island."
                                                [/message]
                                                {OBJECTIVES_HEADER}
                                                    {CONDITION_WIN ( _ "Defeat all enemy leaders")}
                                                    {OBJECTIVES_LOSE}
                                                    {GOLD_CARRYOVER_STANDARD}
                                                {OBJECTIVES_FOOTER}
                                            [/then]
                                            [else]
                                                [endlevel]
                                                    result=victory
                                                    bonus=yes
                                                    next_scenario=Parched_Sands
                                                    carryover_percentage={ON_DIFFICULTY 80 70 60}
                                                [/endlevel]
                                            [/else]
                                        [/if]
                                    [/then]
                                    [else]
                                        [if]
                                            [variable]
                                                name=unit.race
                                                equals="undead"
                                            [/variable]
                                            [then]
                                                [message]
                                                    speaker=Rhys
                                                    message= _ "Oh no... on no!!!"
                                                [/message]
                                                [store_unit]
                                                    [filter]
                                                        id=Rhys
                                                    [/filter]
                                                    variable=rhys_store
                                                [/store_unit]
                                                [store_unit]
                                                    [filter]
                                                        id=Davies
                                                    [/filter]
                                                    variable=davies_store
                                                [/store_unit]
                                                [animate_unit]
                                                    [filter]
                                                        x,y=$x1,$y1
                                                    [/filter]
                                                    flag=attack
                                                    [primary_attack]
                                                        range=melee
                                                    [/primary_attack]
                                                    hits=kill
                                                    [facing]
                                                        x=$rhys_store.x
                                                        y=$rhys_store.y
                                                    [/facing]
                                                [/animate_unit]
                                                [kill]
                                                    id=Rhys
                                                    animate=yes
                                                    fire_event=no
                                                    [secondary_unit]
                                                        x,y=$x1,$y1
                                                    [/secondary_unit]
                                                    [primary_attack]
                                                        range=melee
                                                    [/primary_attack]
                                                [/kill]
                                                [animate_unit]
                                                    [filter]
                                                        x,y=$x1,$y1
                                                    [/filter]
                                                    flag=attack
                                                    [primary_attack]
                                                        range=melee
                                                    [/primary_attack]
                                                    hits=kill
                                                    [facing]
                                                        x=$davies_store.x
                                                        y=$davies_store.y
                                                    [/facing]
                                                [/animate_unit]
                                                [kill]
                                                    id=Davies
                                                    animate=yes
                                                    fire_event=no
                                                    [secondary_unit]
                                                        x,y=$x1,$y1
                                                    [/secondary_unit]
                                                    [primary_attack]
                                                        range=melee
                                                    [/primary_attack]
                                                [/kill]
                                            [/then]
                                            [else]
                                                [message]
                                                    speaker=Davies
                                                    message= _ "Yo! We need passage off this island! We will pay you all that we have!"
                                                [/message]
                                                [message]
                                                    speaker=unit
                                                    message= _ "That can be arranged... for the right price."
                                                [/message]
                                                [message]
                                                    speaker=Rhys
                                                    sound=gold.ogg
                                                    message= _ "I trust this will be enough."
                                                [/message]
                                                [message]
                                                    speaker=unit
                                                    message= _ "Indeed so! Come on, lads. Let's get you two out of here."
                                                [/message]
                                            [/else]
                                        [/if]
                                        [message]
                                            speaker=Malakar
                                            message= _ "No! Without the map we will never find our way back home!"
                                        [/message]
                                        [endlevel]
                                            result=defeat
                                            music=defeat.ogg,defeat2.ogg
                                        [/endlevel]
                                    [/else]
                                [/if]
                            [/else]
                        [/if]
                        {CLEAR_VARIABLE pirates_move}
                    [/then]
                [/if]
            [/then]
            [else]
                [allow_undo]
                [/allow_undo]
            [/else]
        [/if]
    [/event]

    {FREEDOM_DEATHS_UNFORGIVER}

    [event]
        name=die
        [filter]
            id=Rhys
        [/filter]
        [message]
            speaker=Kogw
            message= _ "No! Without my navigator, we cannot sail!"
        [/message]
        [endlevel]
            result=defeat
            music=defeat.ogg,defeat2.ogg
        [/endlevel]
    [/event]

    [event]
        name=recruit
        [filter]
            type=Walking Corpse
        [/filter]
        [scroll_to_unit]
            id=$unit.id
            highlight=yes
        [/scroll_to_unit]
        [redraw][/redraw]
        [delay]
            time=123
        [/delay]
        [if]
            [have_unit]
                id=Davies
            [/have_unit]
            [then]
                [message]
                    speaker=Davies
                    message= _ "Hey, Rhys. I have a new guess about what's wrong with this island."
                [/message]
            [/then]
            [else]
                [if]
                    [variable]
                        name=pirates_captured
                        boolean_equals=no
                    [/variable]
                    [then]
                        [scroll_to]
                            x,y=$pirate_x,$pirate_y
                        [/scroll_to]
                        [message]
                            speaker=narrator
                            caption= _ "Davies"
                            image="units/human-outlaws/pirate.png"
                            message= _ "Hey, Rhys. I have a new guess about what's wrong with this island."
                        [/message]
                        [message]
                            speaker=narrator
                            caption= _ "Rhys"
                            image="units/human-outlaws/pirate.png"
                            message= _ "Hopefully they still answer to gold..."
                        [/message]
                    [/then]
                [/if]
            [/else]
        [/if]
        [scroll_to_unit]
            id=$unit.id
            highlight=yes
        [/scroll_to_unit]
        [redraw][/redraw]
        [delay]
            time=123
        [/delay]
    [/event]

    [event]
        name=turn 2
        [allow_recruit]
            side=2,3,4
            type=Skeleton
        [/allow_recruit]
    [/event]

    [event]
        name=recruit
        [filter]
            type=Skeleton
        [/filter]
        [scroll_to_unit]
            id=$unit.id
            highlight=yes
        [/scroll_to_unit]
        [redraw][/redraw]
        [delay]
            time=123
        [/delay]
        [if]
            [have_unit]
                id=Rhys
            [/have_unit]
            [then]
                [message]
                    speaker=Rhys
                    message= _ "See! A skeleton! I told you so!"
                [/message]
            [/then]
            [else]
                [if]
                    [variable]
                        name=pirates_captured
                        boolean_equals=no
                    [/variable]
                    [then]
                        [scroll_to]
                            x,y=$pirate_x,$pirate_y
                        [/scroll_to]
                        [message]
                            speaker=narrator
                            caption= _ "Rhys"
                            image="units/human-outlaws/pirate.png"
                            message= _ "See! A skeleton! I told you so!"
                        [/message]
                    [/then]
                [/if]
            [/else]
        [/if]
        [scroll_to_unit]
            id=$unit.id
            highlight=yes
        [/scroll_to_unit]
        [redraw][/redraw]
        [delay]
            time=123
        [/delay]
    [/event]

    [event]
        name=die
        [filter]
            id=Davies
        [/filter]
        [message]
            speaker=Kogw
            message= _ "No! Without my helmsman, we cannot sail!"
        [/message]
        [endlevel]
            result=defeat
            music=defeat.ogg,defeat2.ogg
        [/endlevel]
    [/event]

    [event]
        name=enemies defeated
        [if]
            [variable]
                name=gave_up_kogw
                boolean_equals=no
            [/variable]
            [then]
                [endlevel]
                    result=victory
                    bonus=yes
                    carryover_percentage={ON_DIFFICULTY 80 70 60}
                [/endlevel]
            [/then]
            [else]
                [if]
                    [variable]
                        name=pirates_captured
                        boolean_equals=yes
                    [/variable]
                    [then]
                        [endlevel]
                            result=victory
                            bonus=yes
                            next_scenario=Parched_Sands
                            carryover_percentage={ON_DIFFICULTY 80 70 60}
                        [/endlevel]
                    [/then]
                    [else]
                        [message]
                            speaker=Theracar
                            image=$theracar_image
                            message= _ "We have slain the deserter leaders but we must still track down the pirates and their map!"
                        [/message]
                        {OBJECTIVES_HEADER}
                            {CONDITION_WIN ( _ "Capture the pirates")}
                            {OBJECTIVES_LOSE}
                            {GOLD_CARRYOVER_STANDARD}
                        {OBJECTIVES_FOOTER}
                    [/else]
                [/if]
            [/else]
        [/if]
    [/event]

    [event]
        name=die
        first_time_only=no
        [filter]
            side=2,3,4
        [/filter]
        [filter_second]
            id=Unforgiver
        [/filter_second]
        {VARIABLE_OP unforgiver_kill_count add 1}
        [if]
            [variable]
                name=unforgiver_kill_count
                equals=3 # uh... why *exactly* 3? Why not "greater_than_equal_to=" instead?
            [/variable]
            [then]
                {CONDITIONAL_AWARD_ACHIEVEMENT ftf_offshore_artillery}
            [/then]
            [else]
                # (TODO)
            [/else]
        [/if]
    [/event]

    [event]
        name=victory
        [if]
            [variable]
                name=gave_up_kogw
                boolean_equals=yes
            [/variable]
            [then]
                [message]
                    speaker=Malakar
                    message= _ "Drakes! We have a hard flight ahead of us. But our homeland beckons! Today we must gather our supplies, and build rafts to carry with us so we can rest during our journey. Tomorrow we fly!"
                [/message]
            [/then]
            [else]
                [message]
                    speaker=Malakar
                    message= _ "To Morogor!"
                [/message]
            [/else]
        [/if]
        {MAKE_NONLOYAL Rhys}
        {MAKE_NONLOYAL Davies}
        {CLEAR_VARIABLE unforgiver_kill_count}
        {CLEAR_VARIABLE pirates_captured}
        {CLEAR_VARIABLE pirate_x}
        {CLEAR_VARIABLE pirate_y}
    [/event]

    {FTF_COMMON}

    {RESTORE_RECALL_AFTER_DISMISS_BRANCH_A}
[/scenario]
